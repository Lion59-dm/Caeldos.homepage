<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D&D Character Sheet</title>
<style>
body {
  font-family: 'Georgia', serif;
  margin: 0;
  padding: 40px 0 0 0;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  color: #fff;
  min-height: 100vh;
  text-shadow: 1px 1px 3px #000;
  display: flex;
}
.left-panel { width: 33.33%; padding: 20px; box-sizing: border-box; overflow-y: auto; }
.right-panel { width: 66.66%; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; overflow: hidden; }
h1 { display:flex; align-items:center; justify-content:center; gap:15px; }
.profile-pic { width:60px;height:60px;border-radius:50%;border:3px solid purple;object-fit:cover; }
label { display:block;margin-top:8px;font-weight:bold; }
input,textarea,select { width:100%; padding:6px; margin-top:4px; border-radius:5px; border:none; background:rgba(255,255,255,0.15); color:#fff; outline:none; box-shadow:0 0 3px rgba(0,0,0,0.4); box-sizing:border-box; }
textarea { resize: vertical; }
.stats-row { display:flex; gap:10px; margin-top:10px; }
.stats-row > div { flex:1; }
.tab-buttons { display:flex; gap:10px; margin-bottom:10px; }
.tab-buttons button { flex:1; padding:10px; border:none; border-radius:6px; background:rgba(255,255,255,0.2); color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; }
.tab-buttons button.active { background:rgba(255,255,255,0.4); }
.tab-content { flex:1; display:flex; flex-direction:column; background:rgba(0,0,0,0.2); border-radius:8px; padding:10px; overflow:auto; }
.wallpaper-buttons { display:flex; gap:10px; margin-top:10px; }
.wallpaper-buttons button { flex:1; background:rgba(255,255,255,0.2); color:#fff; border:none; border-radius:6px; padding:8px 12px; cursor:pointer; transition:0.3s; }
.wallpaper-buttons button:hover { background:rgba(255,255,255,0.4); }
.action-section { display:flex; gap:6px; align-items:center; transition:height 0.18s ease; }
.action-section input { flex:1; min-width:0; }
.delete-action-btn { flex:0 0 60px; background:rgba(255,0,0,0.5); border:none; border-radius:4px; color:#fff; cursor:pointer; padding:4px 8px; }
.delete-action-btn:hover { background:rgba(255,0,0,0.8); }
#addActionBtn,#addSpellBtn,#addInventoryBtn { margin-top:10px; padding:6px; border:none; border-radius:5px; background:rgba(255,255,255,0.2); color:#fff; cursor:pointer; }
#addActionBtn:hover,#addSpellBtn:hover,#addInventoryBtn:hover { background:rgba(255,255,255,0.4); }
.inventory-headers { display:flex; gap:10px; font-weight:bold; margin-bottom:4px; }
.inventory-headers div { flex:1; }
</style>
</head>
<body>
<div class="left-panel">
  <h1><img src="./Images/Character.png" class="profile-pic" alt="Profile Pic">D&D Character Sheet</h1>
  <div class="stats-row">
    <div><label>HP</label><input id="hp" type="number"></div>
    <div><label>AC</label><input id="ac" type="number"></div>
    <div><label>Speed</label><input id="speed" type="number"></div>
    <div><label>Initiative</label><input id="initiative" type="number"></div>
  </div>
  <div class="stats-row">
    <div><label>STR</label><input id="strength" type="number"></div>
    <div><label>DEX</label><input id="dexterity" type="number"></div>
    <div><label>CON</label><input id="constitution" type="number"></div>
    <div><label>INT</label><input id="intelligence" type="number"></div>
    <div><label>WIS</label><input id="wisdom"></div>
    <div><label>CHA</label><input id="charisma"></div>
  </div>
</div>

<div class="right-panel">
  <div class="tab-buttons">
    <button class="tab-btn active" data-tab="actions">Actions</button>
    <button class="tab-btn" data-tab="spells">Spells</button>
    <button class="tab-btn" data-tab="inventory">Inventory</button>
    <button class="tab-btn" data-tab="background">Background</button>
  </div>

  <div class="tab-content">
    <div id="actionsContainer"></div>
    <div id="spellsContainer" style="display:none;"></div>
    <div id="inventoryContainer" style="display:none;">
      <div class="inventory-headers">
        <div>Quantity</div><div>Name</div><div>Description</div>
      </div>
    </div>
    <div id="backgroundContainer" style="display:none;">
      <div>
        <div class="stats-row"><div><label>Name</label><input id="bgName"></div><div><label>Race</label><input id="bgRace"></div></div>
        <div class="stats-row"><div><label>Class</label><input id="bgClass"></div><div><label>Gender</label><input id="bgGender"></div></div>
        <div class="stats-row"><div><label>Size</label><input id="bgSize"></div><div><label>Height</label><input id="bgHeight"></div></div>
        <div class="stats-row"><div><label>Faith</label><input id="bgFaith"></div><div><label>Age</label><input id="bgAge"></div></div>
        <div class="stats-row"><div><label>Weight</label><input id="bgWeight"></div><div><label>Languages</label><input id="bgLanguages"></div></div>
        <div><label>Backstory</label><textarea id="bgBackstory" placeholder="Enter your backstory..." style="flex:1;"></textarea></div>
      </div>
    </div>
  </div>

  <div class="section">
    <label><b>Background Wallpaper</b></label>
    <select id="wallpaperSelect">
      <option value="./Images/Img1.webp">Arcane accident</option>
      <option value="./Images/Img2.avif">Sorceror's training</option>
      <option value="./Images/Img3.jpg">Barbarian's carnage</option>
      <option value="./Images/Img4.jpg">The long ride</option>
    </select>
    <div class="wallpaper-buttons">
      <button id="prevWallpaper">Previous</button>
      <button id="nextWallpaper">Next</button>
    </div>
  </div>
</div>

<script type="module">
// Firebase setup
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDMeSWp-UbFv_jYstUhbB1kkP-Ite-IHM8",
  authDomain: "dnd-caeldos.firebaseapp.com",
  databaseURL: "https://dnd-caeldos-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dnd-caeldos",
  storageBucket: "dnd-caeldos.appspot.com",
  messagingSenderId: "940131839058",
  appId: "1:940131839058:web:2484beb5ffad8fcfd3438b"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Tabs
const tabs=document.querySelectorAll('.tab-btn');
const containers={actions:document.getElementById('actionsContainer'),spells:document.getElementById('spellsContainer'),inventory:document.getElementById('inventoryContainer'),background:document.getElementById('backgroundContainer')};
tabs.forEach(t=>t.addEventListener('click',()=>{Object.values(containers).forEach(c=>c.style.display='none'); containers[t.dataset.tab].style.display='flex'; tabs.forEach(b=>b.classList.remove('active')); t.classList.add('active');}));

// Wallpaper
const wallpaperSelect=document.getElementById('wallpaperSelect'); const wallpapers=Array.from(wallpaperSelect.options).map(o=>o.value);
let wpIndex=0; function setWallpaper(){document.body.style.backgroundImage=`url(${wallpapers[wpIndex]})`; localStorage.setItem('wallpaper',wallpapers[wpIndex]); wallpaperSelect.value=wallpapers[wpIndex];}
wallpaperSelect.addEventListener('change',()=>{wpIndex=wallpapers.indexOf(wallpaperSelect.value); setWallpaper();});
document.getElementById('prevWallpaper').addEventListener('click',()=>{wpIndex=(wpIndex-1+wallpapers.length)%wallpapers.length; setWallpaper();});
document.getElementById('nextWallpaper').addEventListener('click',()=>{wpIndex=(wpIndex+1)%wallpapers.length; setWallpaper();});
window.addEventListener('load',()=>{const saved=localStorage.getItem('wallpaper'); if(saved && wallpapers.includes(saved)) wpIndex=wallpapers.indexOf(saved); setWallpaper();});

// Create sections
function createAction(action={name:'',range:'',hit:'',type:'',damage:'',notes:''}){ const d=document.createElement('div'); d.className='action-section'; ['name','range','hit','type','damage','notes'].forEach((f,i)=>{const input=document.createElement('input'); input.value=action[f]; input.placeholder=['Name','Range','Hit','Damage type','Damage','Notes'][i]; input.addEventListener('input',saveAll); d.appendChild(input);}); const btn=document.createElement('button'); btn.textContent='Delete'; btn.className='delete-action-btn'; btn.onclick=()=>{d.remove();saveAll();}; d.appendChild(btn); return d;}
function createInventory(item={quantity:'',name:'',description:''}){ const d=document.createElement('div'); d.className='action-section'; ['quantity','name','description'].forEach(f=>{const input=document.createElement('input'); input.value=item[f]; input.placeholder=f.charAt(0).toUpperCase()+f.slice(1); input.addEventListener('input',saveAll); d.appendChild(input);}); const btn=document.createElement('button'); btn.textContent='Delete'; btn.className='delete-action-btn'; btn.onclick=()=>{d.remove();saveAll();}; d.appendChild(btn); return d;}

// Buttons
document.getElementById('addActionBtn')?.addEventListener('click',()=>{containers.actions.appendChild(createAction()); saveAll();});
document.getElementById('addSpellBtn')?.addEventListener('click',()=>{containers.spells.appendChild(createAction()); saveAll();});
document.getElementById('addInventoryBtn')?.addEventListener('click',()=>{containers.inventory.appendChild(createInventory()); saveAll();});

// Save/load
function saveAll(){
  const saveData={
    actions:Array.from(containers.actions.querySelectorAll('.action-section')).map(d=>Array.from(d.querySelectorAll('input')).reduce((a,i,j)=>{['name','range','hit','type','damage','notes'][j]?a[['name','range','hit','type','damage','notes'][j]=i.value:a;a; return a;},{})),
    spells:Array.from(containers.spells.querySelectorAll('.action-section')).map(d=>Array.from(d.querySelectorAll('input')).reduce((a,i,j)=>{['name','range','hit','type','damage','notes'][j]?a[['name','range','hit','type','damage','notes'][j]=i.value:a;a; return a;},{})),
    inventory:Array.from(containers.inventory.querySelectorAll('.action-section')).map(d=>{const i=d.querySelectorAll('input'); return {quantity:i[0].value,name:i[1].value,description:i[2].value};}),
    fields:{}
  };
  document.querySelectorAll('input,textarea').forEach(el=>{if(el.id) saveData.fields[el.id]=el.value;});
  set(ref(db),saveData);
}

// Load from Firebase
onValue(ref(db),snapshot=>{const data=snapshot.val(); if(!data) return; if(data.fields) Object.entries(data.fields).forEach(([k,v])=>{const el=document.getElementById(k); if(el) el.value=v;}); if(data.actions){containers.actions.innerHTML=''; data.actions.forEach(a=>containers.actions.appendChild(createAction(a));} if(data.spells){containers.spells.innerHTML=''; data.spells.forEach(s=>containers.spells.appendChild(createAction(s));} if(data.inventory){containers.inventory.innerHTML=''; data.inventory.forEach(i=>containers.inventory.appendChild(createInventory(i));}});
</script>
</body>
</html>
